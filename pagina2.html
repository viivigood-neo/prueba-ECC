<!DOCTYPE html>
<html>
<head>
	    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-MP7WT9P');</script>
    <!-- End Google Tag Manager -->
	<title>Segunda Pagina iframe</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

</head>
<body>
	    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MP7WT9P" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <h2>Segunda página iframe</h2>

    <!-- when the form is submitted, either with submit button or ENTER key, call search() -->
	<form onsubmit="return search()">
	    <input type="text" id="query">
	</form>
	<!-- show the results in this DIV -->
	<div id="results"></div>

	<script type="text/javascript">
		const cx = '001939702519921710925:r3go7yk9ajo' // your search engine id 
	    const apikey = 'AIzaSyAiFRoRDwhyZ1X1Ugn7oLeGCXju49W0ArY' // your api key

	    var url = 'https://www.googleapis.com/customsearch/v1?key='+apikey+'&cx='+cx+'&q=gas';

	    console.log(url);

	    var request = new XMLHttpRequest()

	    request.open('GET', url, true)

		request.onload = function() {
		  // Begin accessing JSON data here
		  var data = JSON.parse(this.response)

		  data.items.forEach(item => {
			  console.log(item.title)
		  })
		}

		// Send request
		request.send()

	</script>

	<script>
	function search() {

		
	    const cx = '001939702519921710925:r3go7yk9ajo' // your search engine id 
	    const apikey = 'AIzaSyAiFRoRDwhyZ1X1Ugn7oLeGCXju49W0ArY' // your api key

	    /* select the input element */
	    let input = document.getElementById('query')

	    var url = 'HOLAhttps://www.googleapis.com/customsearch/v1?key='+apikey+'&cx='+cx+'&q='+input.value;

	    console.log(url);

	    const results = document.getElementById('results');

	    

	    /* fetch the following URL that includes apikey, cx and the value of input */
	    //fetch(`https://www.googleapis.com/customsearch/v1?key=${apikey}&cx=${cx}&q=${input.value}`).then(response => response.text()).then(text => {
	    //    let result = JSON.parse(text)
	    //    result.items.forEach(item => {
	    //    	console.log(item.link);
	    //    	const link = document.createElement('a');
	    //    	link.setAttribute('href',item.link);

	    //    	results.appendChild(link);
	            
	    //    })
	    //})
	    /* make sure the form isn't actually submitted by returning false */
	    //return false 

	    var request = new XMLHttpRequest()

	    request.open('GET', url, true)

		request.onload = function() {
		  // Begin accessing JSON data here
		  var data = JSON.parse(this.response)

		  data.items.forEach(item => {
			  console.log(item.title)
	        	const link = document.createElement('a');
	        	link.setAttribute('href',item.link);

	        	results.appendChild(link);
		  })
		}

		// Send request
		request.send()
	}
	</script>

    <script type="text/javascript">

    $(document).ready(function() {

    	console.log("READY");
    	    //Página Virtual
    	dataLayer.push({ 'event': 'virtualPage', 'pageUrl': 'prueba-iframe/paso2', 'pageName': 'Segun Pagina iframe' });
    	
    	dataLayer.push(
    		{
    			'event': 'promotionClickIframe',
    			'data':
    			{      
			        'event': 'promotionClick', 
			        'ecommerce': {                                
			            'promoClick': {                              
			                'promotions': [{
			                'id': '123Corchete',
			                'name': 'Promo en iframe',
			                'position': 'promo 1',
			                'creative': 'www.Google.com'
			                }]
			            }
			        }
    			}
    		}
    	);

    	dataLayer.push(
    		{
    			'event': 'promotionImpressionIframe',
    			'data':
		    	{             
			        'event': 'promotionImpression', 
			        'ecommerce': {                                
			            'promoView': {                              
			                'promotions': [{
			                'id': '123Corchete',
			                'name': 'Promo en iframe',
			                'position': 'promo 1',
			                'creative': 'www.Google.com'
			                }]
			            }
			        }
		    	}
		    }
    	);

	});
	</script>

</body>
</html>